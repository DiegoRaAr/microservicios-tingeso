

services:
  config-service:
    build:
      context: ./config-service
      dockerfile: Dockerfile
    container_name: config-service
    ports:
      - "8081:8081"
    networks:
      - tingeso-network
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:8081/actuator/health"]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 40s

  eureka-service:
    build:
      context: ./eureka-service
      dockerfile: Dockerfile
    container_name: eureka-service
    ports:
      - "8761:8761"
    networks:
      - tingeso-network
    depends_on:
      config-service:
        condition: service_healthy
    environment:
      - SPRING_CLOUD_CONFIG_ENABLED=false
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:8761/actuator/health"]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 40s

  gateway-service:
    build:
      context: ./gateway-service
      dockerfile: Dockerfile
    container_name: gateway-service
    ports:
      - "8080:8080"
    networks:
      - tingeso-network
    depends_on:
      eureka-service:
        condition: service_healthy
    environment:
      - SPRING_CLOUD_CONFIG_ENABLED=false
      - EUREKA_CLIENT_SERVICE_URL_DEFAULTZONE=http://eureka-service:8761/eureka/
      - EUREKA_INSTANCE_PREFER_IP_ADDRESS=false
      - EUREKA_INSTANCE_HOSTNAME=gateway-service

  client-service:
    build:
      context: ./client-service
      dockerfile: Dockerfile
    container_name: client-service
    ports:
      - "8090:8090"
    networks:
      - tingeso-network
    depends_on:
      eureka-service:
        condition: service_healthy
    environment:
      - SPRING_CLOUD_CONFIG_ENABLED=false
      - EUREKA_CLIENT_SERVICE_URL_DEFAULTZONE=http://eureka-service:8761/eureka/
      - EUREKA_INSTANCE_PREFER_IP_ADDRESS=false
      - EUREKA_INSTANCE_HOSTNAME=client-service
      - SPRING_DATASOURCE_URL=jdbc:mysql://host.docker.internal:3306/bd_microservice_client
      - SPRING_DATASOURCE_USERNAME=diego
      - SPRING_DATASOURCE_PASSWORD=diego1234

  kardex-service:
    build:
      context: ./kardex-service
      dockerfile: Dockerfile
    container_name: kardex-service
    ports:
      - "8091:8091"
    networks:
      - tingeso-network
    depends_on:
      eureka-service:
        condition: service_healthy
    environment:
      - SPRING_CLOUD_CONFIG_ENABLED=false
      - EUREKA_CLIENT_SERVICE_URL_DEFAULTZONE=http://eureka-service:8761/eureka/
      - EUREKA_INSTANCE_PREFER_IP_ADDRESS=false
      - EUREKA_INSTANCE_HOSTNAME=kardex-service
      - SPRING_DATASOURCE_URL=jdbc:mysql://host.docker.internal:3306/bd_microservice_kardex
      - SPRING_DATASOURCE_USERNAME=diego
      - SPRING_DATASOURCE_PASSWORD=diego1234

  loan-service:
    build:
      context: ./loan-service
      dockerfile: Dockerfile
    container_name: loan-service
    ports:
      - "8092:8092"
    networks:
      - tingeso-network
    depends_on:
      eureka-service:
        condition: service_healthy
    environment:
      - SPRING_CLOUD_CONFIG_ENABLED=false
      - EUREKA_CLIENT_SERVICE_URL_DEFAULTZONE=http://eureka-service:8761/eureka/
      - EUREKA_INSTANCE_PREFER_IP_ADDRESS=false
      - EUREKA_INSTANCE_HOSTNAME=loan-service
      - SPRING_DATASOURCE_URL=jdbc:mysql://host.docker.internal:3306/bd_microservice_loan
      - SPRING_DATASOURCE_USERNAME=diego
      - SPRING_DATASOURCE_PASSWORD=diego1234

  tool-service:
    build:
      context: ./tool-service
      dockerfile: Dockerfile
    container_name: tool-service
    ports:
      - "8093:8093"
    networks:
      - tingeso-network
    depends_on:
      eureka-service:
        condition: service_healthy
    environment:
      - SPRING_CLOUD_CONFIG_ENABLED=false
      - EUREKA_CLIENT_SERVICE_URL_DEFAULTZONE=http://eureka-service:8761/eureka/
      - EUREKA_INSTANCE_PREFER_IP_ADDRESS=false
      - EUREKA_INSTANCE_HOSTNAME=tool-service
      - SPRING_DATASOURCE_URL=jdbc:mysql://host.docker.internal:3306/bd_microservice_tool
      - SPRING_DATASOURCE_USERNAME=diego
      - SPRING_DATASOURCE_PASSWORD=diego1234

  price-service:
    build:
      context: ./price-service
      dockerfile: Dockerfile
    container_name: price-service
    ports:
      - "8094:8094"
    networks:
      - tingeso-network
    depends_on:
      eureka-service:
        condition: service_healthy
    environment:
      - SPRING_CLOUD_CONFIG_ENABLED=false
      - EUREKA_CLIENT_SERVICE_URL_DEFAULTZONE=http://eureka-service:8761/eureka/
      - EUREKA_INSTANCE_PREFER_IP_ADDRESS=false
      - EUREKA_INSTANCE_HOSTNAME=price-service
      - SPRING_DATASOURCE_URL=jdbc:mysql://host.docker.internal:3306/bd_microservice_price
      - SPRING_DATASOURCE_USERNAME=diego
      - SPRING_DATASOURCE_PASSWORD=diego1234

  report-service:
    build:
      context: ./report-service
      dockerfile: Dockerfile
    container_name: report-service
    ports:
      - "8095:8095"
    networks:
      - tingeso-network
    depends_on:
      eureka-service:
        condition: service_healthy
    environment:
      - SPRING_CLOUD_CONFIG_ENABLED=false
      - EUREKA_CLIENT_SERVICE_URL_DEFAULTZONE=http://eureka-service:8761/eureka/
      - EUREKA_INSTANCE_PREFER_IP_ADDRESS=false
      - EUREKA_INSTANCE_HOSTNAME=report-service
      - SPRING_DATASOURCE_URL=jdbc:mysql://host.docker.internal:3306/bd_microservice_report
      - SPRING_DATASOURCE_USERNAME=diego
      - SPRING_DATASOURCE_PASSWORD=diego1234

networks:
  tingeso-network:
    driver: bridge

